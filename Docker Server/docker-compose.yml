version: '2'

services:
### Workspace Utilities Container ###########################
    workspace:
        container_name: ir-workspace
        hostname: ir-workspace
        build:
            dockerfile: ./docker/workspace/Dockerfile
            context: ./
        volumes:
            - ./:/var/www
        tty: true
        ports:
            - "8080:8080"
        networks:
          - esnet
### Elasticsearch containers ##############################
    elasticsearch:
      image: docker.elastic.co/elasticsearch/elasticsearch:6.2.2
      container_name: elasticsearch
      environment:
        - cluster.name=docker-cluster
        - bootstrap.memory_lock=true
        - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
      ulimits:
        memlock:
          soft: -1
          hard: -1
      volumes:
        - esdata1:/usr/share/elasticsearch/data
      ports:
        - 9200:9200
      networks:
        - esnet
    elasticsearch2:
      image: docker.elastic.co/elasticsearch/elasticsearch:6.2.2
      container_name: elasticsearch2
      environment:
        - cluster.name=docker-cluster
        - bootstrap.memory_lock=true
        - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
        - "discovery.zen.ping.unicast.hosts=elasticsearch"
      ulimits:
        memlock:
          soft: -1
          hard: -1
      volumes:
        - esdata2:/usr/share/elasticsearch/data
      networks:
        - esnet

### MySQL Container #############################
    mysql:
        container_name: ir-mysql
        hostname: mysql
        build:
          dockerfile: ./docker/mysql/Dockerfile
          context: ./
        env_file:
          - ./docker/development.env
        ports:
          - "8086:3306"
        volumes:
          - mysql-data:/var/lib/mysql
        networks:
          - esnet

### Adminer Container ###########################
    adminer:
        container_name: ir-adminer
        hostname: adminer
        build:
          dockerfile: ./docker/adminer/Dockerfile
          context: ./
        ports:
          - "8083:8080"
        networks:
            - esnet

volumes:
  esdata1:
    driver: local
  esdata2:
    driver: local
  mysql-data:

networks:
  esnet:

